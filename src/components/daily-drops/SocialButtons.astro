---
import { Icon } from "@astrojs/starlight/components";
const { entry } = Astro.locals.starlightRoute;
const social_read = entry.data.social_read || [];
const social_watch = entry.data.social_watch || [];
const social_connect = entry.data.social_connect || [];
const hasSocial =
  social_read.length > 0 ||
  social_watch.length > 0 ||
  social_connect.length > 0;

const STARLIGHT_ICONS = [
  "star",
  "heart",
  "rocket",
  "book",
  "book-open",
  "video",
  "link",
  "share",
  "external",
  "comment",
  "chat",
  "discord",
  "youtube",
  "github",
  "twitter",
  "x.com",
  "facebook",
  "instagram",
  "reddit",
  "linkedin",
] as const;
type StarlightIcon = (typeof STARLIGHT_ICONS)[number];

const getPlatformIcon = (url: string): StarlightIcon => {
  try {
    const hostname = new URL(url).hostname.replace("www.", "").toLowerCase();
    const iconMap: Record<string, StarlightIcon> = {
      "x.com": "x.com",
      "twitter.com": "twitter",
      "reddit.com": "reddit", // Consider using "external-link" if share looks off
      "youtube.com": "youtube",
      "instagram.com": "instagram",
      "whatsapp.com": "comment",
      "discord.com": "discord",
      "facebook.com": "facebook",
      "linkedin.com": "linkedin",
      "github.com": "github",
    };
    return iconMap[hostname] || "external";
  } catch {
    return "external";
  }
};

const getPlatformLabel = (url: string): string => {
  try {
    const hostname = new URL(url).hostname.replace("www.", "");
    return (
      hostname.charAt(0).toUpperCase() + hostname.slice(1).replace(/\..*/, "")
    );
  } catch {
    return "Link";
  }
};
---

{
  hasSocial && (
    <div class="social-hub">
      {social_read.length > 0 && (
        <div class="social-category">
          <h3 class="category-title">ðŸ“– Read the Story</h3>
          <div class="button-grid">
            {social_read.map((url) => (
              <a
                href={url}
                target="_blank"
                rel="noopener noreferrer"
                class="platform-btn"
                aria-label={`Read on ${getPlatformLabel(url)}`}
              >
                <div class="btn-icon">
                  <Icon name={getPlatformIcon(url)} size="1.5rem" />
                </div>
                <span class="btn-text">{getPlatformLabel(url)}</span>
                <span class="btn-action">Read More</span>
              </a>
            ))}
          </div>
        </div>
      )}

      {social_watch.length > 0 && (
        <div class="social-category">
          <h3 class="category-title">ðŸŽ¥ Watch the Story</h3>
          <div class="button-grid">
            {social_watch.map((url) => (
              <a
                href={url}
                target="_blank"
                rel="noopener noreferrer"
                class="platform-btn"
                aria-label={`Watch on ${getPlatformLabel(url)}`}
              >
                <div class="btn-icon">
                  <Icon name={getPlatformIcon(url)} size="1.5rem" />
                </div>
                <span class="btn-text">{getPlatformLabel(url)}</span>
                <span class="btn-action">Watch Now</span>
              </a>
            ))}
          </div>
        </div>
      )}

      {social_connect.length > 0 && (
        <div class="social-category">
          <h3 class="category-title">ðŸ”— Connect</h3>
          <div class="button-grid">
            {social_connect.map((url) => (
              <a
                href={url}
                target="_blank"
                rel="noopener noreferrer"
                class="platform-btn"
                aria-label={`Connect on ${getPlatformLabel(url)}`}
              >
                <div class="btn-icon">
                  <Icon name={getPlatformIcon(url)} size="1.5rem" />
                </div>
                <span class="btn-text">{getPlatformLabel(url)}</span>
                <span class="btn-action">Join</span>
              </a>
            ))}
          </div>
        </div>
      )}
    </div>
  )
}

<style>
  .social-hub {
    margin: 2.5rem 0;
  }

  .social-category {
    margin-bottom: 2rem;
  }

  .category-title {
    font-size: var(--sl-text-lg);
    font-weight: 700;
    color: var(--sl-color-text-high);
    margin: 0 0 1.25rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--sl-color-gray-5);
  }

  .button-grid {
    display: grid;
    /* Changed to auto-fill to prevent stretching */
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 1rem;
    /* Prevents the grid from being too wide on ultra-wide monitors */
    max-width: 100%;
  }

  .platform-btn {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    /* Use Starlight variables for proper Light/Dark support */
    background: var(--sl-color-gray-6);
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 0.5rem;
    text-decoration: none;
    color: var(--sl-color-text-high);
    transition:
      transform 0.2s ease,
      border-color 0.2s ease;
  }
  /* Specific fix for desktop: ensure buttons don't grow infinitely */
  @media (min-width: 768px) {
    .platform-btn {
      max-width: 350px;
    }
  }

  /* Hover States */
  .platform-btn:hover {
    transform: translateY(-2px);
    border-color: var(--sl-color-accent);
    background: var(--sl-color-accent-low);
    text-decoration: none;
  }

  /* Dark Mode Overrides (Respects Starlight Toggle) */
  :global([data-theme="dark"]) .platform-btn {
    background-color: var(--sl-color-gray-6);
    border-color: var(--sl-color-gray-5);
  }

  :global([data-theme="dark"]) .platform-btn:hover {
    background-color: var(--sl-color-accent-low);
    border-color: var(--sl-color-accent-high);
  }

  .btn-icon {
    display: flex;
    align-items: center;
    color: var(--sl-color-accent);
  }

  .btn-text {
    flex: 1;
    font-weight: 600;
    font-size: var(--sl-text-sm);
    /* Prevent text from wrapping awkwardly */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .btn-action {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    color: var(--sl-color-accent);
    background: var(--sl-color-accent-low);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    border: 1px solid var(--sl-color-accent);
  }

  .platform-btn:hover .btn-action {
    opacity: 1;
  }

  @media (max-width: 500px) {
    .button-grid {
      grid-template-columns: 1fr;
    }
  }

  :global([data-theme="dark"]) .platform-btn {
    background: var(--sl-color-gray-6);
    border-color: var(--sl-color-gray-5);
  }
</style>
